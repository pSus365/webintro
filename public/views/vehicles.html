<?php
$pageTitle = "Fleet Manager - Pojazdy";
include 'partials/header.php';
?>

<div class="page-header-row">
    <h1 class="page-title">Pojazdy</h1>
    <?php if ($isAdmin): ?>
    <a href="/add-vehicle" class="btn-primary" style="text-decoration: none;">
        <span class="material-symbols-outlined" style="font-size: 1.25rem;">add</span>
        <span>Dodaj pojazd</span>
    </a>
    <?php endif; ?>
</div>

<div class="controls-section">
    <form class="search-wrapper" action="/vehicles" method="GET">
        <div class="search-icon">
            <span class="material-symbols-outlined">search</span>
        </div>
        <input class="search-input" name="search" placeholder="Szukaj pojazdu" type="text"
            value="<?= $search ?? '' ?>" />
        <?php if(isset($currentFilter) && $currentFilter !== 'all'): ?>
        <input type="hidden" name="filter" value="<?= $currentFilter ?>">
        <?php endif; ?>
    </form>

    <div class="tabs-wrapper">
        <a class="tab-link <?= (!isset($currentFilter) || $currentFilter === 'all') ? 'active' : '' ?>"
            href="/vehicles?filter=all">Wszystkie</a>
        <a class="tab-link <?= (isset($currentFilter) && $currentFilter === 'active') ? 'active' : '' ?>"
            href="/vehicles?filter=active">Aktywne</a>
        <a class="tab-link <?= (isset($currentFilter) && $currentFilter === 'inactive') ? 'active' : '' ?>"
            href="/vehicles?filter=inactive">Nieaktywne</a>
    </div>
</div>

<div class="table-container">
    <div class="table-wrapper">
        <table class="vehicles-table">
            <thead>
                <tr>
                    <th>Nazwa</th>
                    <th>Typ</th>
                    <th>Status</th>
                    <th>Przebieg</th>
                    <th>Następny Przegląd</th>
                    <th>Koszt Serwisu</th>
                    <th>Akcje</th>
                </tr>
            </thead>
            <tbody>
                <?php if(isset($vehicles)): ?>
                <?php foreach ($vehicles as $vehicle): ?>
                <tr>
                    <td class="text-dark font-medium">
                        <?= htmlspecialchars($vehicle['name']) ?>
                    </td>
                    <td>
                        <?= htmlspecialchars($vehicle['type']) ?>
                    </td>
                    <td>
                        <span class="status-badge <?= strtolower(str_replace(' ', '-', $vehicle['status'])); ?>">
                            <?= htmlspecialchars($vehicle['status']) ?>
                        </span>
                    </td>
                    <td>
                        <?= htmlspecialchars($vehicle['mileage']) ?> km
                    </td>
                    <td>
                        <?= htmlspecialchars($vehicle['next_service_date']) ?>
                    </td>
                    <td>
                        <?= htmlspecialchars($vehicle['estimated_service_cost']) ?> PLN
                    </td>
                    <td style="display: flex; gap: 0.5rem; white-space: nowrap;">
                        <a class="action-btn edit" href="/edit-vehicle?id=<?= $vehicle['id']; ?>">Edytuj</a>
                        <a href="/add-maintenance?vehicle_id=<?= $vehicle['id'] ?>" class="action-btn"
                            style="color: var(--amber-text); background-color: var(--amber-bg);" title="Dodaj Serwis">
                            <span class="material-symbols-outlined" style="font-size: 16px;">build</span>
                        </a>
                        <?php if ($isAdmin): ?>
                        <form action="/delete-vehicle" method="POST"
                            onsubmit="return confirm('Czy na pewno chcesz usunąć ten pojazd?');"
                            style="display: inline;">
                            <input type="hidden" name="id" value="<?= $vehicle['id']; ?>">
                            <button type="submit" class="action-btn delete">Usuń</button>
                        </form>
                        <?php endif; ?>
                    </td>
                </tr>
                <?php endforeach; ?>
                <?php endif; ?>
            </tbody>
        </table>
    </div>
</div>

<!-- Add Script for search or other interactions -->
<script src="/public/js/search_vehicles.js"></script>

<?php include 'partials/footer.php'; ?>