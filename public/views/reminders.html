<?php
$pageTitle = "Fleet Manager - Powiadomienia";
include 'partials/header.php';
?>

<div class="page-header-row">
    <h1 class="page-title">Terminarz Przeglądów</h1>
</div>

<div class="reminders-list"
    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
    <?php if(isset($reminders) && count($reminders) > 0): ?>
    <?php foreach ($reminders as $record): ?>
    <?php 
                // Adapt keys from 'maintenances' join 'vehicles'
                $date = $record['maintenance_date'];
                $name = $record['vehicle_name']; // from v.name as vehicle_name
                $description = $record['description'];

                $daysToService = (strtotime($date) - time()) / (60 * 60 * 24);
                $urgencyClass = '';
                if ($daysToService < 0) $urgencyClass = 'overdue';
                elseif ($daysToService <= 7) $urgencyClass = 'urgent';
                elseif ($daysToService <= 30) $urgencyClass = 'warning';
                else $urgencyClass = 'normal';
                
                // Urgency Class Mapping for Styles if needed
                // Assuming CSS handles .reminder-card.urgent etc.
                // If not, we can inline styles or rely on common.css .status-badge logic
                
                // Let's use card-bg from common vars usually, but specific reminder styles might be in common.css or custom.
                // I will add inline styles for specific reminder parts if missing from common.css
    ?>
    <div class="reminder-card <?= $urgencyClass ?>"
        style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 0.5rem; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; position: relative; overflow: hidden;">
        <!-- Border Left Indicator -->
        <div
            style="position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background-color: 
            <?= ($daysToService < 0) ? 'var(--red-text)' : (($daysToService <= 7) ? 'var(--amber-text)' : 'var(--green-text)') ?>;">
        </div>

        <div class="reminder-header" style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div class="reminder-icon" style="color: var(--primary-color);">
                <span class="material-symbols-outlined" style="font-size: 2rem;">
                    <?= $daysToService < 0 ? 'warning' : 'calendar_clock' ?>
                </span>
            </div>
            <?php if($daysToService < 0): ?>
            <span class="status-badge overdue">Opóźniony</span>
            <?php elseif($daysToService <= 7): ?>
            <span class="status-badge urgent">Za
                <?= ceil($daysToService) ?> dni
            </span>
            <?php else: ?>
            <span class="status-badge active">Planowany</span>
            <?php endif; ?>
        </div>

        <div class="reminder-details">
            <h3 style="font-size: 1.125rem; font-weight: 700; color: var(--text-dark); margin-bottom: 0.25rem;">
                <?= htmlspecialchars($name) ?>
            </h3>
            <p class="reminder-type" style="color: var(--text-muted); font-size: 0.875rem;">
                <?= htmlspecialchars($description) ?>
            </p>
        </div>

        <div class="reminder-date"
            style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid var(--border-color);">
            <span class="date-label" style="font-size: 0.875rem; color: var(--text-muted);">Termin:</span>
            <span class="date-value" style="font-weight: 600; color: var(--text-dark);">
                <?= $date ?>
            </span>
        </div>

        <div class="reminder-action" style="margin-top: auto;">
            <button class="btn-secondary" style="width: 100%;"
                onclick="window.location.href='/maintenance'">Zarządzaj</button>
        </div>
    </div>
    <?php endforeach; ?>
    <?php else: ?>
    <div class="no-reminders" style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
        <span class="material-symbols-outlined" style="font-size: 48px; color: var(--text-muted);">task_alt</span>
        <h3 style="margin-top: 1rem; color: var(--text-dark);">Wszystkie przeglądy są aktualne</h3>
        <p style="color: var(--text-muted);">Brak nadchodzących terminów w najbliższym czasie.</p>
    </div>
    <?php endif; ?>
</div>

<?php include 'partials/footer.php'; ?>