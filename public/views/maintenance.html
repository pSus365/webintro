<?php
$pageTitle = "Stitch Design - Utrzymanie";
include 'partials/header.php';
?>

<div class="page-header-row">
    <h1 class="page-title">Utrzymanie Pojazdów</h1>
    <a href="/maintenance/stats" class="btn-primary" style="text-decoration: none;">
        <span class="material-symbols-outlined" style="font-size: 1.25rem;">bar_chart</span>
        <span>Pokaż statystyki</span>
    </a>
</div>

<!-- Vehicles Status Table (Existing) -->
<h2 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; color: var(--text-dark);">Stan Techniczny Pojazdów
</h2>
<div class="table-container" style="margin-bottom: 3rem;">
    <div class="table-wrapper">
        <table class="vehicles-table">
            <thead>
                <tr>
                    <th>Pojazd</th>
                    <th>Typ</th>
                    <th>Status</th>
                    <th>Przebieg</th>
                    <th>Planowany Przegląd</th>
                    <th>Przewidywany Koszt</th>
                    <th>Akcje</th>
                </tr>
            </thead>
            <tbody>
                <?php if(isset($vehicles)): ?>
                <?php foreach ($vehicles as $vehicle): ?>
                <tr>
                    <td class="text-dark font-medium">
                        <?= htmlspecialchars($vehicle['name']); ?>
                    </td>
                    <td>
                        <?= htmlspecialchars($vehicle['type']); ?>
                    </td>
                    <td>
                        <span class="status-badge <?= strtolower(str_replace(' ', '-', $vehicle['status'])); ?>">
                            <?= htmlspecialchars($vehicle['status']); ?>
                        </span>
                    </td>
                    <td>
                        <?= htmlspecialchars($vehicle['mileage']); ?> km
                    </td>
                    <td>
                        <?= htmlspecialchars($vehicle['next_service_date']); ?>
                    </td>
                    <td>
                        <?= htmlspecialchars($vehicle['estimated_service_cost']); ?> PLN
                    </td>
                    <td>
                        <a href="/add-maintenance?vehicle_id=<?= $vehicle['id']; ?>" class="action-btn edit"
                            style="text-decoration: none;">
                            + Dodaj serwis
                        </a>
                    </td>
                </tr>
                <?php endforeach; ?>
                <?php endif; ?>
            </tbody>
        </table>
    </div>
</div>

<!-- Maintenance History Table (New) -->
<h2 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; color: var(--text-dark);">Historia Serwisowa</h2>
<div class="table-container">
    <div class="table-wrapper">
        <table class="vehicles-table">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Pojazd</th>
                    <th>Opis</th>
                    <th>Koszt</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <?php if(isset($maintenances)): ?>
                <?php foreach ($maintenances as $record): ?>
                <tr>
                    <td>
                        <?= htmlspecialchars($record['maintenance_date']); ?>
                    </td>
                    <td class="text-dark font-medium">
                        <?= htmlspecialchars($record['vehicle_name']); ?>
                    </td>
                    <td>
                        <?= htmlspecialchars($record['description']); ?>
                    </td>
                    <td>
                        <?= htmlspecialchars($record['cost']); ?> PLN
                    </td>
                    <td>
                        <span class="status-badge <?= $record['status'] === 'completed' ? 'active' : 'service' ?>">
                            <?= htmlspecialchars($record['status']); ?>
                        </span>
                    </td>
                </tr>
                <?php endforeach; ?>
                <?php endif; ?>
            </tbody>
        </table>
    </div>
</div>

<?php include 'partials/footer.php'; ?>